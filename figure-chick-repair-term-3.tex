\newcommand{\RepairTermTwoVar}{
  \inferrule*
  [lab=\UTRVar]
  {
    {\turnstile
      { \dcontext{E}{\delta_E}{\Gamma}{\delta_\Gamma} }
      { \declDiff{v}{\delta_v}{\delta_{\tau_v}} }
    }
    \and
    {\turnstile
      { \dcontext{E}{\delta_E}{\Gamma}{\delta_\Gamma} }
      { \repairArgs{ [] }{\tau_v}{\delta_{\tau_v}}{\delta_v}{\delta}
      }
    }
  }
  {\turnstile
    { \dcontext{E}{\delta_E}{\Gamma}{\delta_\Gamma} }
    { \repairTermWithoutType{v}{\delta} }
  }
}

\newcommand{\RepairTermTwoApp}{
  \inferrule*
  [lab=\UTRApp]
  {
    {\turnstile
      { \dcontext{E}{\delta_E}{\Gamma}{\delta_\Gamma} }
      { \declDiff{f}{\delta_f}{\delta_{\tau_f}} }
    }
    \and
    {\turnstile
      { \dcontext{E}{\delta_E}{\Gamma}{\delta_\Gamma} }
      { \repairArgs{\range{n}{a_{i}}}{\tau_f}{\delta_{\tau_f}}
        {\delta_f}{\delta}
      }
    }
  }
  {\turnstile
    { \dcontext{E}{\delta_E}{\Gamma}{\delta_\Gamma} }
    { \repairTermWithoutType{ f\ \range{n}{a_{i}} }{\delta} }
  }
}

\newcommand{\RepairTermTwoPi}{
  \inferrule*
  [lab=\UTRPi]
  {
    {\turnstile
      {\dcontext{E}{\delta_E}{\Gamma}{\delta_\Gamma}}
      {\freshOne{x}{\MathSame}{\delta_x}}
    }
    \and
    {\turnstile
      { \dcontext { e } { \delta_E }
        { \Gamma }
        { \delta_\Gamma }
      }
      { \repair { \tau_1 } { \delta_{\tau_1} } { \MathType } { \MathSame } }
    }
    \\\\\\
    {\turnstile
      { \dcontext { e } { \delta_E }
        { \MathCons{\MathLocalAssum{x}{\tau_1}}{\Gamma} }
        { \MathMod{\MathLocalAssum{\delta_x}{\delta_{\tau_1}}}{\delta_\Gamma} }
      }
      { \repair { \tau_2 } { \delta_{\tau_2} } { \MathType } { \MathSame } }
    }
  }
  {\turnstile
    { \dcontext{E}{\delta_E}{\Gamma}{\delta_\Gamma} }
    { \repairTermWithoutType{ \MathPi{\tau_1}{x}{\tau_2} }
      { \MathModPi{\delta_{\tau_1}}{\delta_x}{\delta_{\tau_2}} }
    }
  }
}

\newcommand{\RepairTermTwoMatch}{
  \inferrule*
  [lab=\UTRMatch]
  {
    {\turnstile
      { \dcontext{E}{\delta_E}{\Gamma}{\delta_\Gamma} }
      { \repairTermWithoutType{t}{\delta_t} }
    }
    \and
    {\turnstile
      { \dcontext{E}{\delta_E}{\Gamma}{\delta_\Gamma} }
      { \repairBranches{t}{[b_1 \ldots b_n]}{\delta_b} }
    }
  }
  {\turnstile
    {\dcontext{E}{\delta_E}{\Gamma}{\delta_\Gamma}}
    {\repairTermWithoutType
      {\MathMatch{t}{b_1 \ldots b_n}}
      {\delta}
    }
  }
}

\newcommand{\RepairTermTwoAnnot}{
  \inferrule*
  [lab=\UTRAnnot]
  {
    {\turnstile
      { \dcontext{E}{\delta_E}{\Gamma}{\delta_\Gamma} }
      { \repair{\tau}{\delta_\tau}{\coqinline{Type}}{\MathSame{}} }
    }
    \and
    {\turnstile
      { \dcontext{E}{\delta_E}{\Gamma}{\delta_\Gamma} }
      { \repair{t}{\delta_t}{\tau}{\delta_\tau} }
    }
  }
  {\turnstile
    { \dcontext{E}{\delta_E}{\Gamma}{\delta_\Gamma} }
    { \repairTermWithoutType{\MathAnnot{t}{\tau}}{\MathAnnot{\delta_t}{\delta_\tau}} }
  }
}

\newcommand{\RepairTermTwoOtherwise}{
  \inferrule*
  [lab=\UTROtherwise]
  {  }
  {\turnstile
    {\dcontext{E}{\delta_E}{\Gamma}{\delta_\Gamma}}
    {\repairTermWithoutType{t}{\MathSame}}
  }
}

\begin{Rules}
  {fig:repair-term-3}
  { Rules for repairing terms, term-directed ($\repairTermThreeOp$) }

\begin{mathpar}
  \RepairTermTwoVar{}

  \RepairTermTwoApp{}

  \RepairTermTwoPi{}

  \RepairTermTwoMatch{}

  \RepairTermTwoAnnot{}

  % This is not necessary, as it is encompassed in the otherwise rule
  % {
  %   \inferrule*
  %   [lab=\UTRType]
  %   { u \in \{ \MathProp, \MathSet, \MathType \} }
  %   {\turnstile
  %     { \dcontext{E}{\delta_E}{\Gamma}{\delta_\Gamma} }
  %     { \repairTermWithoutType{u}{\MathSame} }
  %   }
  % }

  \RepairTermTwoOtherwise{}

  \end{mathpar}

\end{Rules}
